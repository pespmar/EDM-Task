---
title: "Interface"
author: "Pablo, Juan, Alejandro"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(shiny)
library(shinydashboard)
library(leaflet)
library(DT)
```



```{r}
load('Data.RData')
```





```{r}
ui <- dashboardPage(
  dashboardHeader(title = "Calidad del Aire en Valencia"),
  dashboardSidebar(
    sidebarMenu(
      menuItem("An치lisis Exploratorio", tabName = "exploratorio", icon = icon("chart-bar")),
      menuItem("Modelo de Ciencia de Datos", tabName = "modelo", icon = icon("robot")),
      menuItem("Mapa de Contaminaci칩n", tabName = "mapa", icon = icon("map"))
    )
  ),
  
  
  
  dashboardBody(
    tabItems(

      
      tabItem(tabName = "exploratorio",
              h2("An치lisis Exploratorio"),
              fileInput("file", "Cargar archivo CSV", accept = c(".csv")),
              DTOutput("table"),
              plotOutput("plot")
      ),
      
      tabItem(tabName = "modelo",
              h2("Modelo de Ciencia de Datos"),
              fileInput("file_modelo", "Cargar archivo CSV", accept = c(".csv")),
              selectInput("variable", "Seleccionar variable objetivo", choices = NULL),
              actionButton("run_model", "Ejecutar Modelo"),
              verbatimTextOutput("model_summary")
      ),
      
      tabItem(tabName = "mapa",
              h2("Mapa de Contaminaci칩n"),
              leafletOutput("mapa")
      )
    )
  )
)

```



```{r}
server <- function(input, output, session) {

  
  data <- reactive({
    req(input$file)
    read.csv(input$file$datapath)
  })
  
  output$table <- renderDT({
    datatable(data())
  })
  
  output$plot <- renderPlot({
    req(data())
    hist(data()[[1]], main = "Histograma de la primera variable", xlab = names(data())[1])
  })
  

  
  
  observe({
    req(input$file_modelo)
    data_modelo <- read.csv(input$file_modelo$datapath)
    updateSelectInput(session, "variable", choices = names(data_modelo))
  })
  
  output$model_summary <- renderPrint({
    req(input$file_modelo, input$variable, input$run_model)
    data_modelo <- read.csv(input$file_modelo$datapath)
    modelo <- lm(as.formula(paste(input$variable, "~ .")), data = data_modelo)
    summary(modelo)
  })

  
  
  
  
  
  output$mapa <- renderLeaflet({
    leaflet() %>%
      addTiles() %>%
      setView(lng = -0.37739, lat = 39.46975, zoom = 13) %>%
      addCircleMarkers(
        lng = c(-0.3426899,
                -0.39631399,
                -0.37648469,
                -0.40855865,
                -0.37665323,
                -0.3374074,
                -0.36955032,
                -0.40603766,
                -0.32321741),
        lat = c(39.45750439,
                39.45037852,
                39.47071883,
                39.48113875,
                39.45806013,
                39.47962193,
                39.47948825,
                39.46923859,
                39.45926486),
        label = c(
          "AvenidaFrancia",
          "BulevarSur",
          "Centre",
          "MolidelSol",
          "PistadeSilla",
          "UPV",
          "Viveros",
          "Olivereta",
          "Puerto",
        ),
        color = "red",
        radius = 10
      )
  })
}


```



```{r}
shinyApp(ui = ui, server = server)
```











