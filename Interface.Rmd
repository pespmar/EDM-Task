---
title: "Interface"
author: "Pablo, Juan, Alejandro"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(shiny)
library(shinydashboard)
library(leaflet)
library(DT)
library(plotly)
```



```{r}
load('Data.RData')
load('PreRenderedGraphs.RData')
```


```{r}
opciones = c("AvenidaFrancia", "Centre", "MoliDelSol",
             "PistaDeSilla", "UPV", "Olivereta"
             , "Puerto", "COMPLETE")

```



```{r}
ui <- dashboardPage(
  dashboardHeader(title = "Air Contamination"),
  dashboardSidebar(
    sidebarMenu(
      menuItem("Data Exploratory Analysis", tabName = "exploratory", icon = icon("chart-bar")),
      menuItem("Data Science Model", tabName = "model", icon = icon("robot")),
      menuItem("Pollution Map", tabName = "map", icon = icon("map"))
    )
  ),
  
  
  dashboardBody(
    tabItems(

      tabItem(tabName = "exploratory",
              h2("Data Exploratory Analysis"),
              selectInput("select", "Select one Station:", choices = opciones),
              uiOutput("plot")
      ),
      
      tabItem(tabName = "model",
              h2("Data Science Model"),
              verbatimTextOutput("model_summary")
      ),
      
      tabItem(tabName = "map",
              h2("Pollution Map"),
              leafletOutput("mapa")
      )
    )
  )
)

```







```{r}
server <- function(input, output, session) {

  
  data <- reactive({
    req(input$file)
    read.csv(input$file$datapath)
  })
  
  output$table <- renderDT({
    datatable(data())
  })
  
  output$plot <- renderUI({
    req(input$select)
    plotlyOutput("selected_plot")
  })
  
  
  
  output$selected_plot <- renderPlotly({
    req(input$select)
    graficosPMporHora[[input$select]]
  })
  

  
  output$model_summary <- renderPrint({
    req(input$file_modelo, input$variable, input$run_model)
    data_modelo <- read.csv(input$file_modelo$datapath)
    modelo <- lm(as.formula(paste(input$variable, "~ .")), data = data_modelo)
    summary(modelo)
  })

  
  
  
  
  
  output$mapa <- renderLeaflet({
    leaflet() %>%
      addTiles() %>%
      setView(lng = -0.37739, lat = 39.46975, zoom = 13) %>%
      addCircleMarkers(
        lng = c(-0.3426899,
                -0.37648469,
                -0.40855865,
                -0.37665323,
                -0.3374074,
                -0.40603766,
                -0.32321741,
                -0.32894501),
        lat = c(39.45750439,
                39.47071883,
                39.48113875,
                39.45806013,
                39.47962193,
                39.46923859,
                39.45926486,
                39.45051894),
        label = c(
          "AvenidaFrancia",
          "Centre",
          "MolidelSol",
          "PistadeSilla",
          "UPV",
          "Olivereta",
          "Puerto",
          "LlicAnticTuria"
        ),
        color = "red",
      )
  })
}


```



```{r}
shinyApp(ui = ui, server = server)
```











